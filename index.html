<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab6 - Memoria</title>
    <style>
      body {
        font-family: sans-serif;
        background-color: #f5f5f5;
        margin: 0;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(4, 80px);
        gap: 10px;
        justify-content: center;
        margin-top: 20px;
      }

      .card {
        width: 80px;
        height: 80px;
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        cursor: pointer;
        user-select: none;
      }

      #root {
        width: 100%;
        max-width: 600px;
      }
    </style>
  </head>
  <body>
    <h1>MEMORIA √âPICA</h1>
    <div id="root"></div>

    <script
      src="https://unpkg.com/react@18/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
      crossorigin
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const initialValues = ["üêê", "üó£Ô∏è", "üòÇ", "üë®üèΩ‚Äçüíª", "üò≥", "ü´©", "üòé", "üéÆ"];

      const shuffleArray = (array) => {
        const newArr = [...array];
        for (let i = newArr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
        }
        return newArr;
      };

      const generateShuffledCards = () => {
        const duplicated = [...initialValues, ...initialValues];
        const shuffled = shuffleArray(duplicated);
        return shuffled.map((value, index) => ({
          id: index,
          value,
          isFlipped: false,
          isMatched: false,
        }));
      };



      const App = () => {
        const [cards, setCards] = React.useState(generateShuffledCards());

        const [firstCard, setFirstCard]  = React.useState(null);
        const [secondCard, setSecondCard] = React.useState(null);
        const [disabled, setDisabled] = React.useState(false);
        const [moves, setMoves] = React.useState(0);

        const resetTurn = () => {
            setFirstCard(null);
            setSecondCard(null);
            setDisabled(false);
        };

        const handleCardClick = (card) => {
            if (disabled || card.isFlipped || card.isMatched) return;

            const flippedCard = { ...card, isFlipped: true};
            const updatedCards = cards.map(c => c.id === card.id ? flippedCard : c);
            setCards(updatedCards);

            if (!firstCard) {
                setFirstCard(flippedCard);
            } else if (!secondCard) {
                setSecondCard(flippedCard);
                setDisabled(true);
                setMoves(prev => prev + 1);

                if (firstCard.value === flippedCard.value) {
                    setCards( prev =>
                        prev.map(c => 
                            c.value === flippedCard.value ? { ...c, isMatched: true} : c
                        )
                    );
                    resetTurn();
                } else {
                    setTimeout(() => {
                        setCards(prev =>
                            prev.map(c =>
                                c.id === firstCard.id || c.id === flippedCard.id
                                ? { ...c,  isFlipped: false}
                                : c
                            )
                        );
                        resetTurn();
                    },1000);
                }
            }
        };

        return (
          <div>
            <p>Total tarjetas: {cards.length}</p>
            <p>Movimientos: {moves}</p>
            <div className="grid">
              {cards.map((card) => (
                <div key={card.id} className="card" onClick={() => handleCardClick(card)}>
                  {card.isFlipped || card.isMatched ? card.value : "‚ùì"}
                </div>
              ))}
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
